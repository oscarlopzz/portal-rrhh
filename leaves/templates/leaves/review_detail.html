{% extends "portalapp/base.html" %}
{% block content %}
<h2>Revisar ausencia #{{ item.id }}</h2>

<div class="row">
  <div class="col-md-8">
    <div class="card mb-3">
      <div class="card-body">
        <dl class="row mb-0">
          <dt class="col-sm-4">Empleado</dt>
          <dd class="col-sm-8">{{ item.employee }}</dd>

          <dt class="col-sm-4">Tipo</dt>
          <dd class="col-sm-8">{{ item.get_ltype_display }}</dd>

          <dt class="col-sm-4">Inicio</dt>
          <dd class="col-sm-8">{{ item.start_date }}</dd>

          <dt class="col-sm-4">Fin</dt>
          <dd class="col-sm-8">{{ item.end_date }}</dd>

          <dt class="col-sm-4">Estado</dt>
          <dd class="col-sm-8">{{ item.get_status_display }}</dd>

          <dt class="col-sm-4">Justificada</dt>
          <dd class="col-sm-8">{% if item.is_justified %}Sí{% else %}No{% endif %}</dd>

          <dt class="col-sm-4">Motivo / Nota</dt>
          <dd class="col-sm-8">{{ item.justification_note|default:item.reason|default:"—" }}</dd>
        </dl>
      </div>
    </div>

    {% comment %} Lista rápida de justificantes relacionados (si existen) {% endcomment %}
    <div class="card mb-3">
      <div class="card-header">Justificantes relacionados</div>
      <div class="card-body p-0">
        <table class="table mb-0">
          <thead>
            <tr><th>ID</th><th>Tipo</th><th>Fecha</th><th>Estado</th><th>Documento</th></tr>
          </thead>
          <tbody>
          {% for j in item.justifications.all %}
            <tr>
              <td>{{ j.id }}</td>
              <td>{{ j.get_jtype_display }}</td>
              <td>{{ j.issue_date }}</td>
              <td>{{ j.get_status_display }}</td>
              <td>
                {% if j.document %}<a href="{{ j.document.url }}" target="_blank">Ver</a>{% else %}<span class="text-muted">—</span>{% endif %}
              </td>
            </tr>
          {% empty %}
            <tr><td colspan="5" class="text-muted">Sin justificantes.</td></tr>
          {% endfor %}
          </tbody>
        </table>
      </div>
    </div>

    <div class="d-flex gap-2">
      <form method="post" action="" class="d-inline">
        {% csrf_token %}
        <input type="hidden" name="decision" value="APPROVED">
        <button class="btn btn-success">Aprobar</button>
      </form>
      <form method="post" action="" class="d-inline">
        {% csrf_token %}
        <input type="hidden" name="decision" value="REJECTED">
        <button class="btn btn-danger">Rechazar</button>
      </form>
      <a href="{% url 'leaves_review_list' %}" class="btn btn-outline-secondary ms-auto">Volver</a>
    </div>
  </div>
</div>
{% endblock %}
